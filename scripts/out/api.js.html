<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: api.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: api.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Representa una clase PlayerAPI donde gestionar las llamadas a la API que hacen referencia al usuario.
 * @constructor
 */

class PlayerAPI {
    constructor() {
        /**
         * @type {String}
         * */
        this.token = "";
    }

    /**
     * Función encargada de obtener el token del Jugador Actual
     * @returns {String} - Identificador único del Jugador Actual
     */
    get getToken() {
        return this.token;
    }

    /**
     * Función encargada de actualizar el token del Jugador Actual
     * @param token - Identificador único del Jugador Actual
     */
    setToken(token) {
        this.token = token;
    }

    /**
     * Funcion encargada de llamar a la API para crear un Nuevo Jugador
     * @param playerName - Nombre del usuario
     * @param callback - Función callback donde tratar la información de la API
     */
    createNewPlayer(playerName, callback) {
        function reqListener() {
            let response;
            if (this.readyState === XMLHttpRequest.DONE &amp;&amp; this.status === 200) {
                response = "El jugador ha sido creado correctamente!";
                console.log(response, this.status);
            } else {
                response = "Ha ocurrido un error!";
                console.log(response, this.status);

            }
            callback(response, this.status, this.responseText);
        }

        var ajaxASYNC_GET = {
            request: function (url) {
                var xhr = new XMLHttpRequest();
                xhr.addEventListener("load", reqListener);
                xhr.open("GET", url, true);
                xhr.send();
            }
        };

        ajaxASYNC_GET.request("http://puigpedros.salleurl.edu/pwi/arena/api/spawn/" + playerName);
    }

    /**
     * Funcion encargada de llamar a la API para actualizar el Jugador Actual
     * @param token - Identificqador único del Jugador Actual
     * @param callback - Función callback donde tratar la información de la API
     */
    respawnCurrentPlayer(token, callback) {
        function reqListener() {
            let response;
            if (this.readyState === XMLHttpRequest.DONE &amp;&amp; this.status === 200) {
                response = "El jugador ha sido actualizado correctamente!";
                console.log(response, this.status);
            } else {
                response = "Ha ocurrido un error!";
                console.log(response, this.status);

            }
            callback(response, this.status);
        }

        var ajaxASYNC_GET = {
            request: function (url) {
                var xhr = new XMLHttpRequest();
                xhr.addEventListener("load", reqListener);
                xhr.open("GET", url, true);
                xhr.send();
            }
        };

        ajaxASYNC_GET.request("http://puigpedros.salleurl.edu/pwi/arena/api/respawn/" + token);
    }

    /**
     * Funcion encargada de llamar a la API para eliminar el Jugador Actual
     * @param token - Identificqador único del Jugador Actual
     * @param callback - Función callback donde tratar la información de la API
     */
    deleteCurrentPlayer(token, callback) {
        function reqListener() {
            let response;
            if (this.readyState === XMLHttpRequest.DONE &amp;&amp; this.status === 200) {
                response = "El jugador ha sido eliminado correctamente!";
                console.log(response, this.status);
            } else {
                response = "Ha ocurrido un error!";
                console.log(response, this.status);
            }
            callback(response, this.status);
        }

        var ajaxASYNC_GET = {
            request: function (url) {
                var xhr = new XMLHttpRequest();
                xhr.addEventListener("load", reqListener);
                xhr.open("GET", url, true);
                xhr.send();
            }
        };

        ajaxASYNC_GET.request("http://puigpedros.salleurl.edu/pwi/arena/api/remove/" + token);
    }

    /**
     * Funcion encargada de llamar a la API para obtener la información del Jugador Actual
     * @param token - Identificqador único del Jugador Actual
     * @param callback - Función callback donde tratar la información de la API
     */
    getCurrentPlayerInfo(token, callback) {
        function reqListener() {
            let response;
            if (this.readyState === XMLHttpRequest.DONE &amp;&amp; this.status === 200) {
                response = "Se ha obtenido la información del Jugador correctamente!";
                console.log(response, this.status);
            } else {
                response = "Ha ocurrido un error!";
                console.log(response, this.status);
            }
            callback(response, this.status, JSON.parse(this.responseText));
        }

        var ajaxASYNC_GET = {
            request: function (url) {
                var xhr = new XMLHttpRequest();
                xhr.addEventListener("load", reqListener);
                xhr.open("GET", url, true);
                xhr.send();
            }
        };

        ajaxASYNC_GET.request("http://puigpedros.salleurl.edu/pwi/arena/api/player/" + token);
    }

    /**
     * Función encargada de mover el Jugador hacia una dirección
     * @param token - Identificqador único del Jugador Actual
     * @param d - Letra coincidente con la dirección objetivo (N,S,E,O)
     * @param callback - Función callback donde tratar la información de la API
     */
    movePlayer(token, d, callback) {
        function reqListener() {
            let response;
            if (this.readyState === XMLHttpRequest.DONE &amp;&amp; this.status === 200) {
                response = "El Jugador se ha movido a la dirección: " + d;
                console.log(response, this.status);
            } else {
                response = "Ha ocurrido un error!";
                console.log(this.responseText);
            }
            callback(response, this.status);
        }

        var ajaxASYNC_GET = {
            request: function (url) {
                var xhr = new XMLHttpRequest();
                xhr.addEventListener("load", reqListener);
                xhr.open("GET", url, true);
                xhr.send();
            }
        };

        ajaxASYNC_GET.request("http://puigpedros.salleurl.edu/pwi/arena/api/move/" + token + "/" + d);
    }

    /**
     * Función encargada de atacar a un Jugador/Enemigo hacia una dirección
     * @param token - Identificqador único del Jugador Actual
     * @param d - Letra coincidente con la dirección objetivo (N,S,E,O)
     * @param callback - Función callback donde tratar la información de la API
     */
    attackPlayer(token, d, callback) {
        function reqListener() {
            let response;
            if (this.readyState === XMLHttpRequest.DONE &amp;&amp; this.status === 200) {
                response = "El Jugador ha atacado a la dirección: " + d;
                console.log(response, this.status);
            } else {
                response = "Ha ocurrido un error!";
                console.log(this.responseText);
            }
            callback(response, this.status);
        }

        var ajaxASYNC_GET = {
            request: function (url) {
                var xhr = new XMLHttpRequest();
                xhr.addEventListener("load", reqListener);
                xhr.open("GET", url, true);
                xhr.send();
            }
        };

        ajaxASYNC_GET.request("http://puigpedros.salleurl.edu/pwi/arena/api/attack/" + token + "/" + d);
    }

    //TODO: ERROR AL RECUPERAR EL RANKING, POR CULPA DEL FORMATO, NO FUNCIONA JSON.parse()

    /**
     * Función encargada de obtener el Ranking de Jugadores
     * @param callback - Función callback donde tratar la información de la API
     */
    showRanking(callback) {
        function reqListener() {
            let response;
            if (this.readyState === XMLHttpRequest.DONE &amp;&amp; this.status === 200) {
                response = "Se ha mostrado correctamente el Ranking";
                console.log(response, this.status);
            } else {
                response = "Ha ocurrido un error!";
                console.log(this.responseText);
            }
            // callback(response, this.status, JSON.parse(this.responseText));
            callback(response, this.status, this.responseText);

        }

        var ajaxASYNC_GET = {
            request: function (url) {
                var xhr = new XMLHttpRequest();
                xhr.addEventListener("load", reqListener);
                xhr.open("GET", url, true);
                xhr.send();
            }
        };

        ajaxASYNC_GET.request("http://puigpedros.salleurl.edu/pwi/arena/api/ranking");
    }

    /**
     * Funcion encargada de llamar a la API para obtener información detallada de los jugadores y enemigos localizados en celdas colindantes
     * @param token - Identificqador único del Jugador Actual
     * @param callback - Función callback donde tratar la información de la API
     */
    getNearPlayers(token, callback) {
        function reqListener() {
            let response;
            if (this.readyState === XMLHttpRequest.DONE &amp;&amp; this.status === 200) {
                response = "Se ha obtenido correctamente la información de los enemigos colindantes!";
                console.log(response, this.status);
            } else {
                response = "Ha ocurrido un error!";
                console.log(this.responseText);
            }
            callback(response, this.status, JSON.parse(this.responseText));
        }

        var ajaxASYNC_GET = {
            request: function (url) {
                var xhr = new XMLHttpRequest();
                xhr.addEventListener("load", reqListener);
                xhr.open("GET", url, true);
                xhr.send();
            }
        };

        ajaxASYNC_GET.request("http://puigpedros.salleurl.edu/pwi/arena/api/players/" + token);
    }

    /**
     * Funcion encargada de llamar a la API para obtener la información del mapa (localización de los enemigos)
     * @param callback - Función callback donde tratar la información de la API
     */
    getMapInfo(callback) {
        function reqListener() {
            let response;
            if (this.readyState === XMLHttpRequest.DONE &amp;&amp; this.status === 200) {
                response = "Se ha obtenido correctamente la información del mapa!";
                console.log(response, this.status);
            } else {
                response = "Ha ocurrido un error!";
                console.log(this.responseText);
            }
            callback(response, this.status, JSON.parse(this.responseText));
        }

        var ajaxASYNC_GET = {
            request: function (url) {
                var xhr = new XMLHttpRequest();
                xhr.addEventListener("load", reqListener);
                xhr.open("GET", url, true);
                xhr.send();
            }
        };

        ajaxASYNC_GET.request("http://puigpedros.salleurl.edu/pwi/arena/api/map");
    }

    /**
     * Función encargada de refrescar el juego a tiempo real
     */
    refreshGame() {
        fetch("http://puigpedros.salleurl.edu/pwi/arena/api/player/" + player.getToken) //getPlayerInfo
            .then((response) => {
                return response.json();
            })
            .then((data) => {
                player = new Player(data);
                updateViewWithPlayerInfo();
                initMap();
            })
            .then(function () {
                setTimeout(getMapInfo, 2000);
                // getMapInfo();
            })
            .then(function () {
                setTimeout(getNearPlayers, 2000);
                // getNearPlayers();
            }).then(function () {
            refreshGame();
        }).catch((e) => {
            console.log("error: " + e);
        })
    }

}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Map.html">Map</a></li><li><a href="global.html#Player">Player</a></li><li><a href="PlayerAPI.html">PlayerAPI</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addButtonsEvent">addButtonsEvent</a></li><li><a href="global.html#addTextToConsole">addTextToConsole</a></li><li><a href="global.html#blockControlButtons">blockControlButtons</a></li><li><a href="global.html#blockCreatePlayerButton">blockCreatePlayerButton</a></li><li><a href="global.html#blockDeletePlayerButton">blockDeletePlayerButton</a></li><li><a href="global.html#blockRankingButton">blockRankingButton</a></li><li><a href="global.html#blockRevivePlayerButton">blockRevivePlayerButton</a></li><li><a href="global.html#closeCreatePlayerForm">closeCreatePlayerForm</a></li><li><a href="global.html#closeRanking">closeRanking</a></li><li><a href="global.html#COLUMNS">COLUMNS</a></li><li><a href="global.html#createElement">createElement</a></li><li><a href="global.html#createMap">createMap</a></li><li><a href="global.html#enableControlButtons">enableControlButtons</a></li><li><a href="global.html#enableCreatePlayerButton">enableCreatePlayerButton</a></li><li><a href="global.html#enableDeletePlayerButton">enableDeletePlayerButton</a></li><li><a href="global.html#enableRankingButton">enableRankingButton</a></li><li><a href="global.html#enableRevivePlayerButton">enableRevivePlayerButton</a></li><li><a href="global.html#getMapInfo">getMapInfo</a></li><li><a href="global.html#getNearPlayers">getNearPlayers</a></li><li><a href="global.html#getPlayerInfo">getPlayerInfo</a></li><li><a href="global.html#getTime">getTime</a></li><li><a href="global.html#initAttackControls">initAttackControls</a></li><li><a href="global.html#initCornerVisors">initCornerVisors</a></li><li><a href="global.html#initGame">initGame</a></li><li><a href="global.html#initMap">initMap</a></li><li><a href="global.html#initMoveControls">initMoveControls</a></li><li><a href="global.html#initPlayersControls">initPlayersControls</a></li><li><a href="global.html#initUI">initUI</a></li><li><a href="global.html#onClickAttack">onClickAttack</a></li><li><a href="global.html#onClickCreateNewPlayer">onClickCreateNewPlayer</a></li><li><a href="global.html#onClickDeletePlayer">onClickDeletePlayer</a></li><li><a href="global.html#onClickMove">onClickMove</a></li><li><a href="global.html#onClickRevivePlayer">onClickRevivePlayer</a></li><li><a href="global.html#onClickShowRanking">onClickShowRanking</a></li><li><a href="global.html#openCreatePlayerFrom">openCreatePlayerFrom</a></li><li><a href="global.html#openRanking">openRanking</a></li><li><a href="global.html#refreshGame">refreshGame</a></li><li><a href="global.html#restartVisor">restartVisor</a></li><li><a href="global.html#ROWS">ROWS</a></li><li><a href="global.html#setVisorImage">setVisorImage</a></li><li><a href="global.html#updateViewWithPlayerInfo">updateViewWithPlayerInfo</a></li><li><a href="global.html#updateVisor">updateVisor</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Wed May 06 2020 01:39:31 GMT+0200 (GMT+02:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
